<div class="store_jobs">
    <label class="page_headers">Jobs</label>
    <br>
    <div id="no_jobs" class="hidden_now">
        <p>There are currently no job postings available. Please check back soon.</p>
    </div>
    <div id="retail_jobs" class="hidden_now">
        <div id="retail_jobs_container">
            <script id="retail_jobs_template" type="x-tmpl-mustache/text">
                <div class="accordion" id="accordion2">
                    <div class="accordion-group">
                        <div class="accordion-heading">            
                            <div class="accordion-toggle" data-toggle="collapse" data-parent="#accordion{{id}}" href="#collapse{{id}}">
                                <i style="font-size:30px; line-height:2;"class="fa fa-arrow-circle-down pull-right"></i>
                                <label class="job_store_name">{{store_name}}</label>                    
                                <label class="job_title">{{name}}</label>                        
                            </div>
                        </div>
                        <div id="collapse{{id}}" class="accordion-body collapse">
                            <div class="accordion-inner">
                                <p><strong>Closing Date: </strong>{{end_date}}</p>
                                <p><strong class="job_type">{{job_type}}</strong></p>
                                <p>{{{rich_description}}}</p>
                                <a href="/stores/{{store_slug}}">View Store</a> 
                            </div>
                        </div>
                    </div>
                </div>
            </script>
        </div>
    </div>
    <div id="mall_jobs" class="hidden_now">
        <div id="mall_jobs_container">
            <script id="mall_jobs_template" type="x-tmpl-mustache/text">
                <div class="accordion" id="accordion2">
                    <div class="accordion-group">
                        <div class="accordion-heading">            
                            <div class="accordion-toggle" data-toggle="collapse" data-parent="#accordion{{id}}" href="#collapse{{id}}">
                                <i style="font-size:30px; line-height:2;"class="fa fa-arrow-circle-down pull-right"></i>
                                <label class="job_store_name">{{store_name}}</label>                    
                                <label class="job_title">{{name}}</label>                        
                            </div>
                        </div>
                        <div id="collapse{{id}}" class="accordion-body collapse">
                            <div class="accordion-inner">
                                <p><strong>Closing Date: </strong>{{end_date}}</p>
                                <p><strong class="job_type">{{job_type}}</strong></p>
                                <p>{{{rich_description}}}</p>
                                <a href="/stores/{{store_slug}}">View Store</a> 
                            </div>
                        </div>
                    </div>
                </div>
            </script>
        </div>
    </div>
</div>
<script>
    $(document).ready(function(e){
        init(e);
        function renderAll(){
            var jobs = getJobsList();
            var mall_published_jobs = [];
            var retailer_published_jobs = [];
            $.each(jobs, function(key, val){
                if(val.jobable_type == "Property"){
                    today = moment();
                    webDate = moment(val.show_on_web_date)
                    if (today.tz(getPropertyTimeZone()) >= webDate.tz(getPropertyTimeZone())) {
                        mall_published_jobs.push(val);
                    }
                } else {
                    today = moment();
                    webDate = moment(val.show_on_web_date);
                    var store_name = getStoreDetailsByID(val.jobable_id).name;
                    if (today.tz(getPropertyTimeZone()) >= webDate.tz(getPropertyTimeZone())) {
                        val.store_name = store_name;
                        retailer_published_jobs.push(val);
                    }     
                } 
            });
            var retail_jobs = retailer_published_jobs.sortBy(function(o){ return o.store_name});
            if(retail_jobs.length > 0){
                renderJobs("#retail_jobs_container","#retail_jobs_template", retail_jobs);
                $("#retail_jobs").show();
            }
            if(mall_published_jobs.length > 0){
                renderJobs("#mall_jobs_container","#mall_jobs_template", mall_published_jobs);
                $("#prop_jobs").show();
            }
            if(mall_published_jobs.length < 1 && retail_jobs.length < 1){
                $("#no_jobs").show();   
            }
        }
        loadMallData(renderAll); 
    });
</script>